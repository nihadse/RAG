import streamlit as st
from PIL import Image

# --- Initialize session state variables ---
if "chat_sessions" not in st.session_state:
    st.session_state.chat_sessions = {}

if "current_chat" not in st.session_state:
    st.session_state.current_chat = None

# --- Load and display logo ---
image = Image.open("/mnt/logo-banque.png")
st.image(image)

# --- Sidebar: Chat session controls ---
with st.sidebar:
    st.header("Chat Sessions")

    # Create new chat
    if st.button("+ New Chat"):
        new_chat_name = f"Chat {len(st.session_state.chat_sessions) + 1}"
        st.session_state.chat_sessions[new_chat_name] = []
        st.session_state.current_chat = new_chat_name

    # Display and select existing chats
    if st.session_state.chat_sessions:
        selected_chat = st.radio(
            "Select Chat",
            options=list(st.session_state.chat_sessions.keys()),
            index=0 if st.session_state.current_chat is None else list(st.session_state.chat_sessions.keys()).index(st.session_state.current_chat)
        )
        st.session_state.current_chat = selected_chat

# --- Main chat interface ---
st.title("RAG Chatbot")

# Display chat history
chat_container = st.container()

with chat_container:
    if st.session_state.current_chat:
        for message in st.session_state.chat_sessions[st.session_state.current_chat]:
            with st.chat_message(message["role"]):
                st.markdown(message["content"])

                if message["role"] == "assistant":
                    with st.expander("Details"):
                        st.write("**Sources:**", message.get("sources", "N/A"))
                        st.write("**Evaluation:**", message.get("evaluation", "N/A"))
    else:
        st.info("Please start a new chat or select an existing one.")


